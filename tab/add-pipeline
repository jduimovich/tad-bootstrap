SCRIPTDIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )" 
source $SCRIPTDIR/configure  
CMD=$(basename $0)
 
TAB_REPO=$(git config --get remote.origin.url)   
TAB_COMPONENT=$(basename $TAB_REPO)

PIPELINE_TYPE="${1:-docker-build}" 
TAB_IMAGE="${2:-quay.io/jduimovich0/$TAB_COMPONENT}"
NS=$(oc project --short)
TAB_NS="${3:-$NS}" 
TAB_APP="${4:-unknown-app}"  

if test -f Dockerfile; then 
     TAB_DOCKERFILE_LOCATION=Dockerfile 
else
     if test -f docker/Dockerfile; then 
          TAB_DOCKERFILE_LOCATION=docker/Dockerfile
     else 
          echo "No dockerfile"
          exit 0
     fi
fi  
TAB_BUILD_CONTEXT=.  

mkdir -p $COMPONENTS_PATH
cp -r $TEMPLATE_DIR/$PIPELINE_TYPE/* $COMPONENTS_PATH/   
cp -r $TEMPLATE_DIR/repository.yaml $COMPONENTS_PATH/repository.yaml   
 
export REPOURL=$(git config --get remote.origin.url) 
export NAME=$(basename $REPOURL)    
export IMAGE="${2:-quay.io/jduimovich0/$NAME}"
export NAMESPACE=$(oc project --short)  
export APPNAME=$NAME 
export NAME=$NAME
export REPOURL=$REPOURL
export ARGOCOMPONENT=components/$NAME/overlays/development  

bash $SCRIPTDIR/../ta-engine/util-template-expand-directory $COMPONENTS_PATH/ n default

git add .
git commit -m "Added Pipelines"
git push 
oc apply -f $COMPONENTS_PATH/repository.yaml
 
 